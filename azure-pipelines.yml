# Node.js

# Build a general Node.js project with npm.
# Add steps that analyze code, save build artifacts, deploy, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/javascript

#TODO: remove this so it triggers on all branches
trigger:
- master

pool:
  vmImage: 'ubuntu-latest'

steps:
- task: UsePythonVersion@0
  inputs:
    versionSpec: '3.7'
    addToPath: true
    architecture: 'x64'

- script: |
      python -m pip install --upgrade pip 
      pip3 install --upgrade setuptools
      pip install -e .[dev]
    displayName: 'Upgrade pip and python'
    continueOnError: false

- script: |
      pip install pytest pytest-runner
    displayName: 'Install test dependencies'
    continueOnError: false

      # Run Tests
- script: |
      py.test tests --cache-clear --junitxml=result.xml
    displayName: 'Run tests'
    continueOnError: false

# Print test results
- task: PrintTestResults
    inputs:
      testResultsFiles: 'result.xml'
      testRunTitle: 'Python Tests'
      condition: succeededOrFailed()